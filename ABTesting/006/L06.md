# Расчёт длительности А/B теста + продвинутые топики

На этом уроке:
+ Разберем как можно рассчитывать сколько нужно проводить эксперимент
+ Как проверять ваши данные на нормальность
+ Нюансы множественных сравнений
+ Что такое бутстрап и когда его можно и нужно применять

# Содержание

+ [Базовые понятия статистики](#базовые-понятия-статистики)
+ [Определение необходимой численности выборки](#определение-необходимой-численности-выборки)
    + [Определение численности выборки для доли](#определение-численности-выборки-для-доли)
    + [Определение численности выборки для среднего](#определение-численности-выборки-для-среднего)
+ [Дополнительные материалы и используемые источники](#дополнительные-материалы-и-используемые-источники)


[Содержание курса](/ABTesting/README.MD)

## Базовые понятия статистики

На предыдущем занятии мы разбирали следующие понятия:

__Нулевая гипотеза__ – принимаемое предположение о том, что не существует связи между наблюдениями в двух (или более) событиях (выборках, феноменах, совокупностях). <br>
Гипотезу отвергают, если данные показывают разницу между выборками.

__True Positive__ = говорим истина, когда по факту истина (факт)

__True Negative__ = говорим не истина, когда по факту тоже не истина (факт)

__False Positive__ (ошибка I рода) = говорим истина, когда по факту не истина. Отклонение верной нулевой гипотезы. Риск совершить такую ошибку равен выбранному уровню статистической значимости (например, α=0.05) (ошиблись)

__False Negative__ (ошибка II рода) = говорим не истина, когда по факту истина (ошиблись). Принятие неверной нулевой гипотезы. Вероятность ошибочно сохранить неверную нулевую гипотезу обозначают буквой β (например, 0.2).

__Мощность критерия/теста__ - это вероятность, что тест правильно засечёт эффект там, где он и правда есть. (т.е. 1-β) .

Введем несколько новых:

__Зависимые выборки__ – это те выборки, в которых каждому респонденту одной выборки поставлен в соответствие по определенному признаку респондент другой выборки. <br>
__Пример:__ пользователь уже был в эксперименте X, и на нем же проводим эксперимент Y.

__Независимые выборки__ – это те выборки, в которых вероятность отбора любого респондента одной выборки не зависит от отбора любого из респондентов другой выборки.<br>
__Пример:__ рандомно взятые новые пользователи

Эти понятия нам пригодятся в дальнейшем, важно знать их и понимать их суть.

Мы в продуктах не хотим принимать ложноотрицательные(отклонять крутые гипотезы) и ложноположительные(раскатывать плохие гипотезы) решения и хотим минимизировать ошибку первого и второго рода.<br>
Выбираем alpha и ищем самый мощный критерий среди корректных.

Мощность и точность зависят от размера выборки - чем большую мощность и точность мы хотим - тем больше выборка нам нужна - поговорим об этом в следующей главе. Вам сейчас важно понять суть различных ошибок - поскольку в дальнейшем они будут использоваться регулярно.

[Содержание](#содержание)

<hr>

## Определение необходимой численности выборки

Расчет численности выборки очень важный этап планирования A/B-тестов, который может с:
1. Понимать, сколько нужно юзеров для проведения эксперимента
2. Понимать сколько продлится эксперимент
3. Приоритезировать эксперименты 

[Содержание](#содержание)

<hr>

### Определение численности выборки для доли

Предположим, что вы предложили запустить A/B-тест, в котором в версии (B) будет другая форма подтверждения заказа. Нынешняя конверсия сайта = 1% Мы предполагаем, что в новой версии конверсия вырастет до 1,5% <br>
Сколько юзеров нужно отправить на каждую из версий? 

Воспользуемся [калькулятором](https://mindbox.ru/academy/ab-test-calculator/)

Теперь мы знаем, что для того, чтобы получить статистически значимый результат при заданном уровнем конверсии на обеих выборках, нам нужно направить на каждый вариант теста (A и B) по 6 216 юзеров. 

__Пример:__ Предположим, что вы предложили запустить A/B-тест, в котором в версии (B) будет другая форма подтверждения заказа. <br>
Нынешняя конверсия сайта = 0,7% Мы предполагаем, что в новой версии конверсия вырастет до 1,1% <br>
Сколько юзеров нужно отправить на каждую из версий, если мы хотим провести тест с уровнем доверия 99%? 

Воспользуемся калькулятором 

Это задание для студентов. Ответ: 10 147


[Содержание](#содержание)

<hr>

### Определение численности выборки для среднего

Предположим, что ARPU нынешней версии продукта равен 100. 

SD (стандартное отклонение) от ARPU равен 20 

Мы предполагаем, что в новой версии продукта ARPU будет равна 105. 

Необходимо рассчитать численность выборки для этого теста 

Воспользуемся калькулятором [Sample Size Calculator for Comparing Two Independent Means](https://statulator.com/SampleSize/ss2M.html)

![Калькулятор](/ABTesting/Pictures/006_001.png)

Теперь мы знаем, что для того, чтобы получить статистически значимый результат при заданном уровнем конверсии на обеих выборках, нам нужно направить на каждый вариант теста (A и B) по 252 юзера. 


__Пример:__ <br>
Предположим, что LTV нынешней версии продукта равен 1000. SD (стандартное отклонение) от LTV равен 200 

Мы предполагаем, что в новой версии продукта LTV будет равен 1050. 

Необходимо рассчитать численность выборки для этого теста с помощью [калькулятора](https://statulator.com/SampleSize/ss2M.html). 

Это задание для студентов. 

__Ответ:__ 252 

Теперь мы умеем рассчитывать необходимую численность выборки для получения статистически значимых результатов. Не забывайте всегда анализировать, какой тип метрики мы сравниваем: метрику о доли или метрику о среднем.

[Содержание](#содержание)

<hr>

## Дополнительные материалы и используемые источники

1. [Видео про описательную статистику](https://www.youtube.com/watch?v=4SEX9Bozktw)
2. [Книга Голая статистика](https://www.livelib.ru/book/1001518877-golaya-statistika-samaya-interesnaya-kniga-o-samoj-skuchnoj-nauke-charlz-uilan)
3. [Книга статистика и котики](https://www.livelib.ru/book/1002721779-statistika-i-kotiki-vladimir-savelev)
4. [Книга Statistics in Nutshell](https://www.oreilly.com/library/view/statistics-in-a/9781449361129/)
5. [Базовые концепты статистики](https://medium.com/nuances-of-programming/8-базовых-понятий-статистики-для-науки-о-данных-14a1ed2e31ae)
6. [Хорошее описание ЦПТ](https://www.marketing.spb.ru/lib-around/stat/Naked_Statistics.htm)
7. [Введение в основы статистики от Анатолия Карпова](https://www.youtube.com/watch?v=9jL5JifQ1WI)
8. [Z score и p-value](https://medium.com/@ashishtuteja87/what-is-z-score-and-p-value-b7daf7db008f)
9. [Лекции ВШЭ по проверке гипотез](https://mse.msu.ru/wp-content/uploads/2020/03/Лекция-6-Проверка-гипотез.pdf)
10. [Про интерпретацию p-value на русском](https://habr.com/ru/company/stepic/blog/250527/)
11. [Про интерпретацию p-value на английском](http://www.perfendo.org/docs/BayesProbability/twelvePvaluemisconceptions.pdf)
12. [Про выбор критериев](https://lit-review.ru/biostatistika/vybor-statisticheskogo-kriteriya/)
13. [Лекции МШЭ МГУ  по проверке гипотез](https://mse.msu.ru/wp-content/uploads/2020/03/Лекция-6-Проверка-гипотез.pdf)
14. [Для желающих почитать про непараметрику](https://mse.msu.ru/wp-content/uploads/2020/04/Лекция-9-непараметрические-методы.pdf)
15. [Про доверительные интервалы от Демешева](https://www.youtube.com/watch?v=GoK7sod8dhU)
16. [Про доверительные интервалы от Кирилла Мильчакова](https://www.youtube.com/watch?v=MstzroncW28)
17. [Про MDE и ошибки 1 и 2 типа - вводная статья](https://medium.com/@PAPP/significant-power-d9c3bc3dd3c)
18. [Про MDE посложнее](https://rpubs.com/hedbergec/sirc)


[Содержание](#содержание)

<hr>

[Содержание](#содержание)

<hr>

[Содержание курса](/ABTesting/README.MD)