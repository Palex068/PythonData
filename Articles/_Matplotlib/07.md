# Файловый вывод

## Содержание

+ [Параметры файлового вывода](#параметры-файлового-вывода)
+ [Многостраничный PDF документ](#многостраничный-pdf-документ)
+ [GIF анимация](#gif-анимация)

[Содержание руководства по Matplotlib](/Articles/_Matplotlib/README.MD)

## Файловый вывод
Несмотря на то что мы можем с легкостью обойтись обычными блокнотами Jupyter, все же иногда нам приходится писать научные статьи или готовить презентации, для которых графики необходимо сохранять в виде отдельных файлов. 

Matplotlib позволяет не только сохранять графики в файлах различных форматов, но еще и задавать параметры сохраняемого файла:
+ размеры изображения,
+ его разрешение и
+ прозрачность. 

Так же возможно создание анимации, но в дальнейшем мы рассмотрим только gif - анимацию.

В самом простом случае, что бы сохранить рисунок графика, нам просто необходимо воспользоваться методом savefig объекта Figure, передав ему всего один параметр - строку с именем будущего файла:

```python
import numpy as np
from matplotlib import pyplot as plt

x = np.linspace(-3, 3, 200)
y = x*(x + 2)*(x - 2)

fig, ax = plt.subplots()

ax.plot(x, y)

plt.show()

fig.savefig('мой график')
```

![Файловый вывод](/Articles/_Matplotlib/Pictures/007_001.PNG)

По умолчанию, полученный файл будет сохранен в формате png, а сам файл вы найдете, либо в директории с исполняемым скриптом. Параметр savefig может принимать путь к будущему файлу, т.е. можно указать необходимую директорию для сохраняемого файла, что очень удобно если необходимо сохранить целую серию картинок:

```python
import numpy as np
from matplotlib import pyplot as plt

x = np.linspace(-3, 3, 200)

fig, ax = plt.subplots()

for a in range(1, 11):
    y = x*(x + 2)*(x - 2)/a
    ax.plot(x, y)
    fig.savefig('mpl_temp/мой график' + str(a))

plt.show()
```

![Файловый вывод](/Articles/_Matplotlib/Pictures/007_002.PNG)

Имя файла может содержать расширение необходимого формата файла, отделенное точкой:

```python
import numpy as np
from matplotlib import pyplot as plt

x = np.linspace(-3, 3, 200)
y = x*(x + 2)*(x - 2)

fig, ax = plt.subplots()

ax.plot(x, y)

plt.show()

fig.savefig('mpl_temp/мой график.png')
fig.savefig('mpl_temp/мой график.pdf')
fig.savefig('mpl_temp/мой график.svg')
fig.savefig('mpl_temp/мой график.jpg')
fig.savefig('mpl_temp/мой график.gif')
```

После выполнения даннго скрипта может появиться сообщение об ошибке:

![Файловый вывод](/Articles/_Matplotlib/Pictures/007_003.PNG)

Из этого сообщения видно, что формат gif не поддерживается, зато есть перечень всех поддерживаемых форматов: eps, jpeg, jpg, pdf, pgf, png, ps, raw, rgba, svg, svgz, tif, tiff

Мы рассмотрели самый простой случай сохранения файлов, однако, если вы сравните изображения полученных файлов, то увидите, что даже этот простой способ, является более чем приемлемым если вы сохраняете файлы в формате pdf или svg, потому что они являются векторными, а значит их качество не изменяется при изменении размеров или масштаба.

<hr>

[Содержание](#содержание)

## Параметры файлового вывода
Помимо поддержки различных графических форматов matplotlib позволяет контролировать множество параметров сохраняемых изображений.

### dpi
Данный параметр задает разрешение сохраняемого рисунка. По умолчанию соотношение сторон области Figure составляет 4:3 или 8x6 пространственных единиц, одна такая единица соответствует 100 пикселям (px). Поэтому все сохраняемые файлы имеют размеры 800x600 px. 

Если указать dpi = 200 то одной такой единице будет соответствовать уже 200 px, а размеры конечного изображения будут равны 8*200x6*200 = 1600x1200 px. 

Параметр dpi может принимать любые целые значения больше 0:

```python
import numpy as np
from matplotlib import pyplot as plt

x = np.linspace(-3, 3, 200)
y = x*(x + 2)*(x - 2)

fig, ax = plt.subplots()

ax.plot(x, y)

fig.savefig('мой график dpi 600.png', dpi = 600)
```
В директории с исполняемым скриптом вы обнаружите файл мой график dpi 600.png с достаточно хорошим разрешением.

### quality
Формат png считается своего рода стандартом, но если вам вдруг понадобилось сохранить график в формате jpg или jpeg, то задать качество сохраняемого изображения задается параметром quality, который может принимать значения в диапазоне от 1 до 100:

```python
import numpy as np
from matplotlib import pyplot as plt

x = np.linspace(-3, 3, 200)
y = x*(x + 2)*(x - 2)

fig, ax = plt.subplots()

ax.plot(x, y)

plt.show()

fig.savefig('мой график quality 70.jpg', quality = 70)
fig.savefig('мой график quality 95.jpg', quality = 95)
fig.savefig('мой график quality 99.jpg', quality = 99)
fig.savefig('мой график quality 100.jpg', quality = 100)
```

### transparent
Делает прозрачными области Figure и Axes, что очень полезно если вам необходимо разместить график поверх фона презентации или web-страницы:

```python
import numpy as np
from matplotlib import pyplot as plt

x = np.linspace(-3, 3, 200)
y = x*(x + 2)*(x - 2)

fig, ax = plt.subplots()

ax.plot(x, y)

plt.show()

fig.savefig('мой график transparent.png',
            transparent = True)
```

<hr>

[Содержание](#содержание)

## Многостраничный PDF документ
Иногда, требуется сохранить целую серию графиков. 

Конечно мы можем сохранить их в виде отдельных картинок в специально отведенной директории, но просмотр таких картинок не очень удобен. 

Гораздо удобнее сохранять такие серии графиков в виде pdf документа. Для этого достаточно воспользоваться одним backend_pdf. 

Допустим у нас есть 25 графиков, давайте посмотрим как их можно поместить в один pdf-документ:

```python
import numpy as np
from matplotlib import pyplot as plt

#  Импортируем pdf-backend:
from matplotlib.backends.backend_pdf import PdfPages

#  Создаем многостраничный pdf файл:
pdf_file = PdfPages('Laplace.pdf')

#  Параметры распределения Лапласа:
loc = np.linspace(1, 2, 5)
scale = np.linspace(5, 10, 5)

for l in loc:
    fig, axes = plt.subplots(5, 1)
    for s in scale:
        laplace = np.random.laplace(l, s, size=1000)
        i = list(scale).index(s)
        axes[i].violinplot(laplace, vert = False)
        axes[i].set_title('scale = ' + str(s))
    fig.suptitle('loc = ' + str(l), y = 0.92, x = 0.51, fontsize = 15)
    fig.set_figheight(10)
    #  Увеличим расстояние между Axes:
    fig.subplots_adjust(hspace=0.5)
    #  Сохраняем область "Figure" на отдельной странице:
    pdf_file.savefig(fig)

#  Сохраняем и закрываем документ:
pdf_file.close()
```
Пример, конечно не самый удачный, но он демонстрирует суть: сначала, pdf_file = PdfPages('Laplace.pdf') мы создаем многостраничный pdf-документ, а затем, командой pdf_file.savefig(fig) сохраняем вновь полученную фигуру на отдельной странице документа.

<hr>

[Содержание](#содержание)

## GIF анимация
Сохранение серии графиков в многостраничном документе является хорошим выходом когда нам нужна статика, возможность уделять внимание отдельным частям графиков. 

Но иногда нам необходима динамика, возможность наблюдать за изменением графика в зависимости от изменения определенного параметра. 

Такую возможность лучше (проще) всего реализовать в виде gif-анимации:

```python
import numpy as np
import matplotlib.pyplot as plt

#  Импортируем модуль для работы с анимацией:
import matplotlib.animation as animation

t = np.linspace(-4, 4, 300)

fig, ax = plt.subplots()

#  Создаем функцию, генерирующую картинки
#  для последующей "склейки":
def animate(i):
    ax.clear()
    line = ax.plot(t, np.sin(i*t))
    return line

#  Создаем объект анимации:
sin_animation = animation.FuncAnimation(fig, 
                                      animate, 
                                      frames=np.linspace(2, 4, 30),
                                      interval = 10,
                                      repeat = False)

#  Сохраняем анимацию в виде gif файла:
sin_animation.save('моя анимация.gif',
                 writer='imagemagick', 
                 fps=30)
```
Данный пример демонстрирует самый простой способ создания анимации - использование класса FuncAnimation. <br>
Данный класс позволяет создавать экземпляры анимации и сохранять. 

При создании указываются следующие атрибуты:
+ fig - объект области Figure, который используется для получения рисунков анимации.
+ func - функция которая генерирует кадры анимации, в нашем случае это функция animate(i).
    + Первый аргумент в данной функции должен определять получение кадров анимации, т.е. как то влиять на изменение картинки, в примере выше параметр i используется при построении функции np.sin(i*t).
    + Следующий атрибут frames по сути это может быть любой итерируемый объект, длина которого определяет количество кадров анимации, в примере выше, это np.linspace(2, 4, 30), т.е. 30 кадров.
+ interval задает задержку кадров в миллисекундах (по умолчанию 200). И наконец
+ repeat - управляет повторением последовательности кадров после завершения их показа (по умолчанию True).

После того, как был создан экземпляр анимации можно переходить к его сохранению с помощью метода __save()__. 

Данный метод принимает в качестве строки имя выходного файла. Далее следует параметр writer - "создатель" анимации, т.е. модуль который способен склеить и сохранить картинки графика в файл, в нашем случае используется imagemagick так как мы хотим создать gif-анимацию. 

И последний используемый параметр - fps - количество кадров в секунду. 

Помимо этого может быть указан параметр dpi - разрешение (количество точек на 1 длинны) получаемых кадров.

Данный параметр позволяет повысить качество анимации, но в то же время возрастает и объем конечного файла.

![Файловый вывод](/Articles/_Matplotlib/Pictures/007_004.gif)

<hr>

[Содержание](#содержание)

<hr>

[Содержание руководства по Matplotlib](/Articles/_Matplotlib/README.MD)